"use strict";
exports.__esModule = true;
exports.patchResponse = void 0;
// We're doing this to buffer up the response body
// so we can send it off to the metrics server
// It's unfortunate that this isn't accessible
// natively. This may take up lots of memory on
// big responses, we can make it configurable in future
function patchResponse(res) {
    var write = res.write, end = res.end;
    res._body = '';
    res.write = function (chunk, encoding, cb) {
        res._body += chunk;
        write.call(res, chunk, encoding, cb);
    };
    res.end = function (chunk, encoding, cb) {
        // Chunk is optional in res.end
        // http://nodejs.org/dist/latest/docs/api/http.html#http_response_end_data_encoding_callback
        if (chunk)
            res._body += chunk;
        end.call(res, chunk, encoding, cb);
    };
}
exports.patchResponse = patchResponse;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGF0Y2gtcmVzcG9uc2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvbGliL3BhdGNoLXJlc3BvbnNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUFBLGtEQUFrRDtBQUNsRCw4Q0FBOEM7QUFDOUMsOENBQThDO0FBQzlDLCtDQUErQztBQUMvQyx1REFBdUQ7QUFDdkQsU0FBZ0IsYUFBYSxDQUFDLEdBQUc7SUFDdkIsSUFBQSxLQUFLLEdBQVUsR0FBRyxNQUFiLEVBQUUsR0FBRyxHQUFLLEdBQUcsSUFBUixDQUFTO0lBRTNCLEdBQUcsQ0FBQyxLQUFLLEdBQUcsRUFBRSxDQUFDO0lBRWYsR0FBRyxDQUFDLEtBQUssR0FBRyxVQUFDLEtBQUssRUFBRSxRQUFRLEVBQUUsRUFBRTtRQUM5QixHQUFHLENBQUMsS0FBSyxJQUFJLEtBQUssQ0FBQztRQUNuQixLQUFLLENBQUMsSUFBSSxDQUFDLEdBQUcsRUFBRSxLQUFLLEVBQUUsUUFBUSxFQUFFLEVBQUUsQ0FBQyxDQUFDO0lBQ3ZDLENBQUMsQ0FBQztJQUVGLEdBQUcsQ0FBQyxHQUFHLEdBQUcsVUFBQyxLQUFLLEVBQUUsUUFBUSxFQUFFLEVBQUU7UUFDNUIsK0JBQStCO1FBQy9CLDRGQUE0RjtRQUM1RixJQUFJLEtBQUs7WUFBRSxHQUFHLENBQUMsS0FBSyxJQUFJLEtBQUssQ0FBQztRQUM5QixHQUFHLENBQUMsSUFBSSxDQUFDLEdBQUcsRUFBRSxLQUFLLEVBQUUsUUFBUSxFQUFFLEVBQUUsQ0FBQyxDQUFDO0lBQ3JDLENBQUMsQ0FBQztBQUNKLENBQUM7QUFoQkQsc0NBZ0JDIn0=